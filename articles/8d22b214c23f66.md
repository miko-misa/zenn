---
title: 'LuaLaTeXã®åŠ›ã§"ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼"ãƒœã‚¿ãƒ³ã‚’ä½œã‚‹'
emoji: "ğŸ“"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["tex", "LaTeX", "lualatex", "listing", "pdf"]
published: true
---

:::message alert
æœ¬è¨˜äº‹ã¯ `luaLaTeX`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¦ã„ã¾ã™.
:::

# å‰å›ã¾ã§ã®ã‚ã‚‰ã™ã˜

ã“ã‚“ãªã“ã¨ã—ã¦ã¾ã—ãŸ.
https://zenn.dev/cyber_hacnosuke/articles/41275710b8f594

# ä»Šå›ã‚„ã‚‹ã“ã¨

ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒœã‚¿ãƒ³ã‚’ä½œã‚Šã¾ã™.`Zenn`ã‚’ã¯ã˜ã‚ã‚’ã—ãŸæŠ€è¡“ç³»ã®ãƒ–ãƒ­ã‚°ã‚„è¨˜äº‹ã€ã‚µã‚¤ãƒˆã§ã¯ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã€ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆã«ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã ã‘ã§ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒã‚³ãƒ”ãƒ¼ã•ã‚Œã‚‹ãƒœã‚¿ãƒ³ãŒã‚ã‚Šã¾ã™ã‚ˆã­ï¼Ÿ

```
ã“ã‚“ãªã‹ã‚“ã˜ã§ã€‚ï¼ˆã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆã«ãƒã‚¦ã‚¹ãƒ›ãƒãƒ¼ã§å‡ºç¾ï¼‰â†—ï¸
```

ãã‚Œã‚’ä½œã‚Šã¾ã™.ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã§ãªã„ä»»æ„ã®æ–‡å­—ã‚‚,ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™.**ã—ã‹ã—,ä»¥ä¸‹ã®åˆ¶ç´„ãŒå¿…è¦ã§ã™.**

- `Adobe Acrobat`ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã“ã¨
- `Adobe Acrobat`ã§å¿…è¦ãªè¨­å®šã‚’è¡Œã£ã¦ã„ã‚‹ã“ã¨
- æ—¥æœ¬èªã‚’å«ã¾ãªã„ã“ã¨ï¼ˆæ—¥æœ¬èªãŒã‚ã‚‹ã¨æ–‡å­—åŒ–ã‘ã—ã¾ã™ï¼‰

å¿…è¦ãªè¨­å®šã¨ã¯ä»¥ä¸‹ã®å†…å®¹ã§ã™.

- `Adobe Acrobat`ã®ç’°å¢ƒè¨­å®šã‚’é–‹ã
- `JavaScript`ã®é …ç›®ã‹ã‚‰`Acrobat JavaScriptã‚’ä½¿ç”¨`ã«ãƒã‚§ãƒƒã‚¯ã‚’ã„ã‚Œã‚‹
- `ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼ˆæ‹¡å¼µï¼‰`ã®é …ç›®ã®`ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç‰¹æ¨©ã®å ´æ‰€`ã«ã“ã® PDF ãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ãã‚ŒãŒæ ¼ç´ã•ã‚ŒãŸãƒ•ã‚©ãƒ«ãƒ€ã‚’è¿½åŠ ã™ã‚‹

# ç™ºæƒ³

https://tex.stackexchange.com/questions/174637/copy-to-clipboard-feature-in-pdf-output/545107#545107

ã“ã®è³ªå•ã‚’è¦‹ã¤ã‘ãŸã®ã§ã“ã‚ŒãŒãƒ™ãƒ¼ã‚¹ã«ãªã‚Šã¾ã™.å¤§ã¾ã‹ãªæµã‚Œã¯ä»¥ä¸‹ã§ã™.

1. `VerbatimOut`ã‚³ãƒãƒ³ãƒ‰ã§ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’**ã‚ã‚Šã®ã¾ã¾**ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä»Šå›ã¯`temp.txt`ï¼‰ã«æ›¸ãå‡ºã™
2. `lstinputlisting`ã§ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
3. ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰ PDF å†…ã«æ–°ã—ã„`field`ã‚’è¿½åŠ ã—ã¦`luaLaTeX`ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã ä¸­èº«ã‚’ã‚»ãƒƒãƒˆ
4. ãƒ¦ãƒ¼ã‚¶ã®ã‚«ãƒ¼ã‚½ãƒ«ã‚’`field`ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
5. `ã™ã¹ã¦é¸æŠ`ã‚’ã•ã›ã‚‹
6. `ã‚³ãƒ”ãƒ¼`ã‚’ã•ã›ã‚‹
7. `field`ã‚’æŠ¹æ¶ˆ

3 ä»¥é™ã¯`Acrobat Javascript API`ï¼ˆæ­£å¼åç§°ä¸æ˜ï¼‰ã‚’åˆ©ç”¨ã—ã¦`Javascript`ã§æ›¸ãã¾ã™.5,6 ã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚ã‚‹æ©Ÿèƒ½ã‚’ç™ºç«ã•ã›ã‚‹`execMenuItem`ã‚’ä½¿ã„ã¾ã™.ã¾ãŸ,ç™ºç«ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ãšã‚‰ã™ãŸã‚ã«`setTimeOut`ã‚’ç”¨ã„ã¾ã™.ã“ã®ã‚³ãƒãƒ³ãƒ‰ã§ã¯`TeX`,`lua`,`Javascript`ã® 3 è¨€èªã‚’ä½¿ã†ã“ã¨ã«ãªã‚Šã¾ã™.

ãªãœã“ã‚“ãªå›ã‚Šãã©ã„ã‚„ã‚Šæ–¹ã‚’ã™ã‚‹ï¼ˆã¨ãã«,ãªãœ`lua`ã‚’ä½¿ç”¨ã™ã‚‹ï¼‰ã®ã‹ã¨ã„ã„ã¾ã™ã¨,`TeX`ã«ç‰¹æ®Šæ–‡å­—ãŒå¤šã„ã®ã¨,ã‚³ãƒãƒ³ãƒ‰ãŒã„ã¤ã€Œå±•é–‹ã€ã•ã‚Œã‚‹ã‹ãŒã‚ã‹ã‚‰ãªã„ã‹ã‚‰ã§ã™.ãã®ãŸã‚,`'`ï¼ˆ`Javascript`ã«ãŠã„ã¦æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã‚’è¡¨ã™ï¼‰,`#`ï¼ˆ`TeX`ã«ãŠã„ã¦å¼•æ•°ã‚’è¡¨ã™ï¼‰,`%`ï¼ˆ`TeX`ã«ãŠã„ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ã™ï¼‰,` `ï¼ˆã‚¹ãƒšãƒ¼ã‚¹ï¼‰,æ”¹è¡Œãªã©ã®ç‰¹æ®Šæ–‡å­—ã‚’`lua`ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã‚€éš›ã«å¤‰ãªæ–‡å­—åˆ—ï¼ˆ`ABC<space>XYZ`ãªã©ï¼‰ã§ç½®æ›ã—ã¦,`Javascript`ã§å…ƒã«æˆ»ã—ã¦ã„ã¾ã™.ã“ã†ã™ã‚‹ã“ã¨ã§,`tex`ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã“ã®æ§˜ãªç‰¹æ®Šæ–‡å­—ãŒä¸€åˆ‡ç¾ã‚Œãªã„å½¢ã«ãªã‚Šã¾ã™.

:::message
ã¾ã ã¾ã ç‰¹æ®Šæ–‡å­—ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã®ã§ãã®éš›ã¯è¿½åŠ ã—ã¦ãã ã•ã„.
:::

# å®Œæˆå“

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ãªã„æ–‡å­—ã¯ã“ã‚Œã§ã§ãã¾ã™.

```tex
\usepackage{media9}

\mediabutton[%
  jsaction={
    var fld = this.addField("ToCopy", "text", \thepage-1, this.getPageBox({nPage: \thepage-1}));
    fld.textSize = 0.1;
    fld.fillColor = color.transparent;
    fld.multiline = true;
    fld.value = 'copy text'; % ã“ã“ãŒã‚³ãƒ”ãƒ¼ã•ã‚Œã‚‹ãƒ†ã‚­ã‚¹ãƒˆã§ã™.
    fld.setFocus();
    app.setTimeOut("app.execMenuItem('SelectAll');", 100);
    app.setTimeOut("app.execMenuItem('Copy');", 200);
    app.setTimeOut("this.removeField('ToCopy');", 300);
  }]{
    \fbox{Copy to Clipboard}% ã“ã®éƒ¨åˆ†ã‚’å¤‰æ›´ã™ã‚Œã°è¦‹ãŸç›®ã‚’å¤‰æ›´ã§ãã¾ã™.
  }
```

æ•°é€±é–“é ‘å¼µã£ãŸçµæœãŒã“ã¡ã‚‰ã§ã™.

```tex
\usepackage{luacode}
\usepackage{verbatim}
\usepackage{listings}
\usepackage{media9}
\usepackage{fancyvrb}
\usepackage{xparse}

\begin{luacode*}
function readtxt(filename, suffix)
  local body = ""
  local suffix = suffix or ""
  local firstline = true
  local sharp_char = string.char(35)
  local percent_char = string.char(37)
  local single_quote = string.char(39)
  local space_char = string.char(32)
  for line in io.lines(filename) do
    line = string.gsub(line, sharp_char, "ABC<sharp>XYZ")
    line = string.gsub(line, percent_char..percent_char, "ABC<percent>XYZ")
    line = string.gsub(line, single_quote, "ABC<quote>XYZ")
    line = string.gsub(line, space_char, "ABC<space>XYZ")
    if not firstline then
      body = body .. "ABC<br>XYZ"
    else
      firstline = false
    end
    body = body .. line
  end
  return body
end
\end{luacode*}

\NewDocumentEnvironment{zennlisting}{O{Python}}
  {\VerbatimOut{temp.txt}}
  {\endVerbatimOut\lstinputlisting[language=#1]{temp.txt}%
  \mediabutton[%
    jsaction={
      var fld = this.addField("ToCopy", "text", \thepage-1, this.getPageBox({nPage: \thepage-1}));
      fld.textSize = 0.1;
      fld.fillColor = color.transparent;
      fld.multiline = true;
      fld.value = '\directlua{tex.sprint(readtxt('temp.txt'))}'.replace(/ABC<br>XYZ/g, String.fromCharCode(10)).replace(/ABC<sharp>XYZ/g, String.fromCharCode(35)).replace(/ABC<quote>XYZ/g, String.fromCharCode(39)).replace(/ABC<space>XYZ/g, String.fromCharCode(32));
      fld.setFocus();
      app.setTimeOut("app.execMenuItem('SelectAll');", 100);
      app.setTimeOut("app.execMenuItem('Copy');", 200);
      app.setTimeOut("this.removeField('ToCopy');", 300);
    }]{
      \fbox{Copy to Clipboard}% ã“ã®éƒ¨åˆ†ã‚’å¤‰æ›´ã™ã‚Œã°è¦‹ãŸç›®ã‚’å¤‰æ›´ã§ãã¾ã™.
    }
  }
```

# ä½¿ã„æ–¹

```tex
\begin{zennlisting}[Python]
# your code
\end{zennlisting}
```
