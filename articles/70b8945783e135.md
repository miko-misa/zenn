---
title: "Selenium × Python × HerokuでGoogle ClassroomをスクレイピングするBOTを作った"
emoji: "🎶"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [python,selenium,google,bot,heroku]
published: false
---

# はじめに
こんにちは。今回はSelenium × Python × Herokuを使ってGoogle Classroomをはじめとしたログインしないとアクセスできないサービスをスクレイピングする方法を書き留めておこうと思います。

## バッググラウンド
そもそも何がしたいのかを説明します。

わが校では夕飯を食堂で頼めるという仕組みがありまして、毎日（次の日の）申請フォーム（`Google Form`）がクラスルーム（`Google Classromm`）送られてきます。当日の午前10:30が締め切りなのですが、意外に忘れる人が多くこれを防止するために`LINE BOT`を作ろうと思いました。

:::message
なお、`LINE BOT`は`Heroku`を使う理由となった以外にあまり関係はないので今回はスルーします。
:::

## 今回の趣旨
今回、大きくやりたいことをまとめると以下のような形になると思います。

- `Heroku` × `Python` 環境を構築したい。
- `Selenium`を`Python`で使いたい。
- `Selenium`を`Heroku`上で動かしたい。
- `Selenium`で`Google Classroom`（など）に入りたい。

# 1. 環境構築
# 1.1. PackageのインストールとHeroku Appの生成
`Python` × `Heroku`の環境構築は多くの方がやられているものと大差ありませんので少し省きつつ構築していきます。また、`Python`や`pip`はインストールされているものとします。



:::message
`webhook`とするための構築となっています。
:::

まずは必要な`package`をインストールしていきます。

```
$ pip install flask
$ pip install selenium
```

次に、`Heroku`関係の構築をします。

```
$ heroku login
```
出てきたURLにアクセスしてログインしてください。

:::message
`Heroku`アカウントが必要ですので[こちらから](https://dashboard.heroku.com/)あらかじめ制作しておいてください。
:::

アプリケーションを生成します。なお、フォルダをその場で生成するのでフォルダ移動を行った後に実行してください。

```
$ heroku create -a <app-name>
```

:::message
今回、`Heroku`上のアプリ名は`<app-name>`と表記しますので、適宜読み替えてください。
:::

これでまずは完了です。

## 1.2. 設定ファイルの準備
次はファイルを作ってアプリとして`deploy`する準備をしましょう。

先ほど生成した`<app-name>`フォルダ内に`main.py`を生成します。

:::message
`main.py`でなくともかまいませんがのちの設定が少し変わります。
:::

`main.py`に仮のコードを書きましょう。

```python:main.py
from flask import Flask, request, abort, jsonify
import os
from time import sleep
from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.by import By

app = Flask(__name__)

@app.route("/")
def hello_world():
    return "hello world!"

```

これで`hello_world`の`webhook`ができます。これだけだと`Heroku`では動いてくれません。ほかの設定ファイルが必要です。


これでpythonのバージョンとインストールした`package`のバージョンを確認します。
```
$ python --version
$ pip freeze
```


以下の三つの設定ファイルを`<app-name>`フォルダ内に生成します。

`runtime.txt`に先ほど確認した`python`のバージョンを書き入れます。
```:runtime.txt
python-3.10.4
```

`requirements.txt`は`Heroku`に必要な`package`を教えます。先ほど`pip freeze`で出力されたもののうち、必要なものだけ抜き出します。
```:requirements.txt
Flask==2.1.0
selenium==4.1.3
```

最後に`Heroku`に実行方法を教えます。
```:Procfile
web: python main.py
```

:::message alert
ファイル名は`Procfile.txt`ではなく`Procfile`です。
:::

これで初期設定はできました。次は`Heroku`に`deploy`しましょう。

## 1.3. HerokuへのDeploy

`deploy`には`git`を使いますのでインストールを済ましておいてください。

`git`でコミットします。
```
$ git init
Initialized empty Git repository in .git/
```

一応、`Heroku`のリポジトリとつながっているか確認します。

```
$ git remote -v
heroku  https://git.heroku.com/<app-name>.git (fetch)
heroku  https://git.heroku.com/<app-name>.git (push)
```
こうなってれば正解です。なって無ければ以下のコマンドをたたいてください。ちなみに僕はなぜかなっていませんでした。

```
$ heroku git:remote -a <app-name>
```

最後に`deploy`の方法ですが、普通の`git`と同じように`commit`して`push`するだけです。

```
$ git add .
$ git commit -m "My first commit"
$ git push heroku main
```

個人的には`Github Desktop`を使うとやりやすいと思います。（`remote`先には十分注意してください。）

:::message
自分のリモートレポジトリを`Heroku`で実行することもできるようですので興味がある方は調べてみてください。
:::

:::message alert
`Heroku`に`deploy`して初めて内容が更新されます。`deploy`し忘れて永遠にエラーを解決しようと東奔西走する私のようにはならないようにしてください。
:::

# 2. Heroku上でSeleniumを動かすぜ
早速`Selenium`を動かしていきましょう。
